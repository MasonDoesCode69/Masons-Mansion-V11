<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mason‚Äôs Mansion | Honey Perfect</title>
    <style>
        :root {
            --bg: #050400;
            --accent: #ffcc33; /* Honey Gold */
            --glow: rgba(255, 204, 51, 0.4);
            --glass: rgba(15, 12, 5, 0.92);
            --border: rgba(255, 204, 51, 0.2);
            --text: #ffffff;
            --font: 'Segoe UI', system-ui, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        body, html { 
            width: 100%; height: 100%; overflow: hidden; 
            background: var(--bg); color: var(--text); 
            font-family: var(--font); cursor: crosshair; touch-action: none;
        }

        #bg-canvas { position: fixed; inset: 0; z-index: 0; background: radial-gradient(circle at center, #1a1500 0%, #050400 100%); }

        /* --- AUTH --- */
        #auth-overlay {
            position: fixed; inset: 0; z-index: 10000;
            display: flex; align-items: center; justify-content: center;
            background: #000; transition: 1s;
        }
        .login-card { background: var(--glass); padding: 40px; border-radius: 30px; border: 1px solid var(--accent); text-align: center; width: 350px; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        .login-card h1 { color: var(--accent); letter-spacing: 5px; margin-bottom: 5px; font-size: 24px; text-shadow: 0 0 10px var(--glow); }
        .credits { font-size: 10px; opacity: 0.6; margin-bottom: 20px; letter-spacing: 2px; text-transform: uppercase; }
        .login-card input { width: 100%; background: #000; border: 1px solid var(--border); padding: 12px; border-radius: 10px; color: #fff; margin-bottom: 10px; text-align: center; transition: 0.3s; }
        .login-card input:focus { border-color: var(--accent); box-shadow: 0 0 10px var(--glow); }
        .login-card button { width: 100%; padding: 12px; border-radius: 10px; border: none; background: var(--accent); color: #000; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .login-card button:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--accent); }

        /* --- SIDEBAR --- */
        #sidebar {
            position: fixed; left: -240px; top: 50%; transform: translateY(-50%);
            width: 240px; background: var(--glass); border: 1px solid var(--border);
            padding: 20px; border-radius: 0 20px 20px 0; z-index: 2000;
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
        }
        #sidebar.open { left: 0; box-shadow: 10px 0 30px rgba(0,0,0,0.5); border-right: 2px solid var(--accent); }
        #sidebar-tab {
            position: absolute; right: -40px; top: 50%; transform: translateY(-50%);
            background: var(--accent); color: #000; padding: 15px 8px;
            border-radius: 0 10px 10px 0; cursor: pointer; font-weight: 900; writing-mode: vertical-rl; font-size: 12px;
            box-shadow: 5px 0 15px var(--glow);
        }

        .option-btn { width: 100%; padding: 10px; margin: 4px 0; background: rgba(255,255,255,0.03); border: 1px solid var(--border); color: #fff; border-radius: 8px; font-size: 11px; cursor: pointer; text-align: left; }
        .option-btn:hover { background: rgba(255,204,51,0.1); border-color: var(--accent); }
        .option-btn.active { background: var(--accent); color: #000; font-weight: bold; }

        /* --- DESKTOP --- */
        #desktop { position: relative; width: 100vw; height: 100vh; z-index: 10; display: none; }
        #taskbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--glass); border: 1px solid var(--border); padding: 10px 20px; border-radius: 20px; display: flex; gap: 15px; z-index: 1000; backdrop-filter: blur(10px); }
        .t-icon { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; background: rgba(255,255,255,0.02); border-radius: 14px; cursor: pointer; font-size: 24px; transition: 0.3s; }
        .t-icon:hover { transform: translateY(-10px) scale(1.1); background: var(--accent); color: #000; box-shadow: 0 10px 20px var(--glow); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>

    <div id="auth-overlay">
        <div class="login-card">
            <h1>MASON V16</h1>
            <p class="credits">Advanced Physics Edition</p>
            <input type="password" id="sys-pass" placeholder="PASSWORD" onkeydown="if(event.key==='Enter') Mansion.init()">
            <button onclick="Mansion.init()">ENTER SYSTEM</button>
        </div>
    </div>

    <div id="desktop">
        <div id="sidebar">
            <div id="sidebar-tab" onclick="document.getElementById('sidebar').classList.toggle('open')">PHYSICS ENGINE</div>
            <h4 style="font-size: 10px; color: var(--accent); margin-bottom: 10px; letter-spacing: 2px;">WORLD CONTROLS</h4>
            <button class="option-btn" onclick="Mansion.spawnSwarm()">1. Spawn Cluster (H)</button>
            <button class="option-btn active" id="m-bounce" onclick="Mansion.toggle('bounce')">2. Elastic Collision</button>
            <button class="option-btn" id="m-magnet" onclick="Mansion.toggle('magnet')">3. Mouse Gravity</button>
            <button class="option-btn" id="m-float" onclick="Mansion.toggle('float')">4. Anti-Gravity</button>
            <button class="option-btn" id="m-rgb" onclick="Mansion.toggle('rgb')">5. RGB Chromatic</button>
            <button class="option-btn" onclick="Mansion.clearOrbs()">6. Clear Board</button>
            <hr style="opacity: 0.1; margin: 10px 0;">
            <p style="font-size: 9px; opacity: 0.5; text-align:center;">Click to Pop | Drag to Move</p>
        </div>

        <div id="taskbar">
            <div class="t-icon" title="Games">üéÆ</div>
            <div class="t-icon" title="Themes">üé®</div>
            <div class="t-icon" title="Settings">‚öôÔ∏è</div>
            <div id="owner-icon" class="t-icon hidden">üëë</div>
        </div>
    </div>

    <script>
        const Mansion = {
            canvas: null, ctx: null, orbs: [],
            mouse: { x: -1000, y: -1000, active: false },
            mods: { bounce: true, magnet: false, float: false, rgb: false },
            accent: '#ffcc33',

            init() {
                const p = document.getElementById('sys-pass').value;
                if(p === "masononly69" || p === "honey") {
                    if(p === "masononly69") document.getElementById('owner-icon').classList.remove('hidden');
                    document.getElementById('auth-overlay').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('auth-overlay').classList.add('hidden');
                        document.getElementById('desktop').style.display = 'block';
                        this.boot();
                    }, 1000);
                } else { alert("ACCESS DENIED"); }
            },

            boot() {
                this.canvas = document.getElementById('bg-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());

                // Mouse/Touch Events
                const updateMouse = (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mouse.x = (e.clientX || e.touches?.[0].clientX) - rect.left;
                    this.mouse.y = (e.clientY || e.touches?.[0].clientY) - rect.top;
                };

                window.addEventListener('mousemove', updateMouse);
                window.addEventListener('mousedown', (e) => { this.mouse.active = true; updateMouse(e); this.checkPop(); });
                window.addEventListener('mouseup', () => { this.mouse.active = false; });
                window.addEventListener('touchstart', (e) => { this.mouse.active = true; updateMouse(e); this.checkPop(); });
                window.addEventListener('touchend', () => { this.mouse.active = false; });

                // Keyboard
                window.addEventListener('keydown', (e) => { if(e.key.toLowerCase() === 'h') this.spawnSwarm(); });

                // Initial Spawn
                for(let i=0; i<15; i++) this.orbs.push(new Bubble(this));
                
                this.animate();
            },

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            },

            toggle(mod) {
                this.mods[mod] = !this.mods[mod];
                document.getElementById('m-'+mod)?.classList.toggle('active');
            },

            spawnSwarm() {
                for(let i=0; i<10; i++) this.orbs.push(new Bubble(this));
            },

            clearOrbs() { this.orbs = []; },

            checkPop() {
                this.orbs = this.orbs.filter(orb => {
                    const dist = Math.hypot(this.mouse.x - orb.x, this.mouse.y - orb.y);
                    return dist > orb.r; // Remove if clicked inside
                });
            },

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.orbs.forEach((orb, i) => {
                    orb.update();
                    orb.draw();
                    
                    // Collision Check (Physics)
                    if(this.mods.bounce) {
                        for(let j = i + 1; j < this.orbs.length; j++) {
                            const other = this.orbs[j];
                            const dx = other.x - orb.x;
                            const dy = other.y - orb.y;
                            const distance = Math.hypot(dx, dy);
                            const minDistance = orb.r + other.r;

                            if (distance < minDistance) {
                                // Resolve Overlap
                                const overlap = minDistance - distance;
                                const nx = dx / distance;
                                const ny = dy / distance;
                                orb.x -= nx * overlap / 2;
                                orb.y -= ny * overlap / 2;
                                other.x += nx * overlap / 2;
                                other.y += ny * overlap / 2;

                                // Elastic collision velocity swap
                                const p = 2 * (orb.vx * nx + orb.vy * ny - other.vx * nx - other.vy * ny) / (orb.r + other.r);
                                orb.vx -= p * other.r * nx;
                                orb.vy -= p * other.r * ny;
                                other.vx += p * orb.r * nx;
                                other.vy += p * orb.r * ny;
                            }
                        }
                    }
                });

                requestAnimationFrame(() => this.animate());
            }
        };

        class Bubble {
            constructor(parent) {
                this.p = parent;
                this.r = Math.random() * 30 + 15;
                this.x = Math.random() * (this.p.canvas.width - this.r * 2) + this.r;
                this.y = Math.random() * (this.p.canvas.height - this.r * 2) + this.r;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4;
                this.hue = Math.random() * 40 + 35; // Honey range
            }

            update() {
                // Apply Float (Anti-gravity)
                if(this.p.mods.float) this.vy -= 0.1;
                else this.vy += 0.02; // Slight gravity

                // Movement
                this.x += this.vx;
                this.y += this.vy;

                // Friction
                this.vx *= 0.99;
                this.vy *= 0.99;

                // Mouse Magnetism/Repulsion
                const dx = this.p.mouse.x - this.x;
                const dy = this.p.mouse.y - this.y;
                const dist = Math.hypot(dx, dy);
                if(dist < 250) {
                    const force = (250 - dist) / 250;
                    if(this.p.mods.magnet) {
                        this.vx += (dx / dist) * force * 0.5;
                        this.vy += (dy / dist) * force * 0.5;
                    } else {
                        // Default Repulsion
                        this.vx -= (dx / dist) * force * 0.4;
                        this.vy -= (dy / dist) * force * 0.4;
                    }
                }

                // Wall Bounce
                if(this.x + this.r > this.p.canvas.width) { this.x = this.p.canvas.width - this.r; this.vx *= -0.8; }
                if(this.x - this.r < 0) { this.x = this.r; this.vx *= -0.8; }
                if(this.y + this.r > this.p.canvas.height) { this.y = this.p.canvas.height - this.r; this.vy *= -0.8; }
                if(this.y - this.r < 0) { this.y = this.r; this.vy *= -0.8; }
            }

            draw() {
                const ctx = this.p.ctx;
                const color = this.p.mods.rgb ? `hsla(${Date.now()/10 % 360}, 70%, 60%, 0.4)` : `rgba(255, 204, 51, 0.3)`;
                
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
                
                // Bubble Gradient
                const grad = ctx.createRadialGradient(this.x - this.r/3, this.y - this.r/3, this.r/10, this.x, this.y, this.r);
                grad.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                grad.addColorStop(0.4, color);
                grad.addColorStop(1, 'rgba(0, 0, 0, 0.1)');
                
                ctx.fillStyle = grad;
                ctx.fill();
                
                // Border
                ctx.strokeStyle = this.p.mods.rgb ? `hsla(${Date.now()/10 % 360}, 70%, 60%, 0.8)` : 'rgba(255, 204, 51, 0.5)';
                ctx.lineWidth = 1;
                ctx.stroke();

                // Shimmer
                ctx.beginPath();
                ctx.arc(this.x - this.r*0.4, this.y - this.r*0.4, this.r*0.15, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255,255,255,0.4)';
                ctx.fill();
            }
        }
    </script>
</body>
</html>
